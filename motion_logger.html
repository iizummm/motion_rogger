<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Motion Logger</title>
  <style>
    body { font-family: sans-serif; padding: 1em; }
    button { margin: 0.5em; padding: 0.5em 1em; }
    pre { background: #f5f5f5; padding: 0.5em; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>ğŸ“± Motion Logger</h1>
  <p>åŠ é€Ÿåº¦ãƒ»ã‚¸ãƒ£ã‚¤ãƒ­ã®ã‚»ãƒ³ã‚µå€¤ã‚’è¨˜éŒ²ã—ã¦CSVã§ä¿å­˜ã—ã¾ã™ï¼ˆiOSã§ã¯è¨±å¯ãŒå¿…è¦ã§ã™ï¼‰ã€‚</p>

  <button onclick="requestPermission()">ã‚»ãƒ³ã‚µä½¿ç”¨è¨±å¯ï¼ˆiOSï¼‰</button>
  <button onclick="startLogging()">è¨˜éŒ²é–‹å§‹</button>
  <button onclick="stopLogging()">è¨˜éŒ²åœæ­¢</button>
  <button onclick="downloadCSV()">CSVä¿å­˜</button>

  <h2>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å€¤</h2>
  <pre id="output">æœªå–å¾—</pre>

  <script>
    let data = [];
    let logging = false;

    function requestPermission() {
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission().then(response => {
          if (response === 'granted') {
            alert("ã‚»ãƒ³ã‚µä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸï¼");
          } else {
            alert("ã‚»ãƒ³ã‚µä½¿ç”¨ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚");
          }
        });
      } else {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ä¸è¦ã§ã™ã€‚");
      }
    }

    window.addEventListener('devicemotion', (event) => {
      const acc = event.acceleration;
      const rot = event.rotationRate;
      const t = new Date().toISOString();

      const row = {
        time: t,
        accX: acc?.x?.toFixed(3),
        accY: acc?.y?.toFixed(3),
        accZ: acc?.z?.toFixed(3),
        rotAlpha: rot?.alpha?.toFixed(2),
        rotBeta: rot?.beta?.toFixed(2),
        rotGamma: rot?.gamma?.toFixed(2)
      };

      document.getElementById("output").textContent =
        `time: ${row.time}\nacc: (${row.accX}, ${row.accY}, ${row.accZ})\nrot: (${row.rotAlpha}, ${row.rotBeta}, ${row.rotGamma})`;

      if (logging) data.push(row);
    });

    function startLogging() {
      data = [];
      logging = true;
      alert("è¨˜éŒ²ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚");
    }

    function stopLogging() {
      logging = false;
      alert("è¨˜éŒ²ã‚’åœæ­¢ã—ã¾ã—ãŸã€‚CSVä¿å­˜ã‚’å¿˜ã‚Œãšã«ï¼");
    }

    function downloadCSV() {
      if (data.length === 0) return alert("ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");

      const csvHeader = "time,accX,accY,accZ,rotAlpha,rotBeta,rotGamma\n";
      const csvRows = data.map(row =>
        `${row.time},${row.accX},${row.accY},${row.accZ},${row.rotAlpha},${row.rotBeta},${row.rotGamma}`
      );
      const csvContent = csvHeader + csvRows.join("\n");

      const blob = new Blob([csvContent], { type: "text/csv" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "motion_log.csv";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
